extend schema
  @link(url: "https://specs.apollo.dev/federation/v2.11", import: ["@shareable"])
  @link(url: "https://specs.apollo.dev/connect/v0.2", import: ["@source", "@connect"])
  @source(name: "inventory_api", http: { baseURL: "http://localhost:4002" })

type Inventory @shareable {
  productId: ID!
  warehouseLocation: String!
  quantity: Int!
}

type InventorySummary {
  productId: ID!
  totalQuantity: Int!
  warehouses: [Inventory!]!
}

type Product
  @connect(
    source: "inventory_api"
    http: { GET: "/inventory/{$this.id}" }
    selection: """
      id: productId
      inventory: {
        productId
        totalQuantity
        warehouses {
          productId
          warehouseLocation
          quantity
        }
      }
    """
  ) {
  id: ID! @shareable
  inventory: InventorySummary
}

type Query {
  allInventory: [Inventory!]!
    @connect(
      source: "inventory_api"
      http: { GET: "/inventory" }
      selection: """
        $.data {
          productId
          warehouseLocation
          quantity
        }
      """
    )

  inventoryByProduct(productId: ID!): InventorySummary
    @connect(
      source: "inventory_api"
      http: { GET: "/inventory/{$args.productId}" }
      selection: """
        productId
        totalQuantity
        warehouses {
          productId
          warehouseLocation
          quantity
        }
      """
    )
}
